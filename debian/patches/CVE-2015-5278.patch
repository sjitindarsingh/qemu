From 737d2b3c41d59eb8f94ab7eb419b957938f24943 Mon Sep 17 00:00:00 2001
From: P J P <pjp@fedoraproject.org>
Date: Tue, 15 Sep 2015 16:46:59 +0530
Subject: [PATCH] net: avoid infinite loop when receiving packets(CVE-2015-5278)

Ne2000 NIC uses ring buffer of NE2000_MEM_SIZE(49152)
bytes to process network packets. While receiving packets
via ne2000_receive() routine, a local 'index' variable
could exceed the ring buffer size, leading to an infinite
loop situation.

Reported-by: Qinghao Tang <luodalongde@gmail.com>
Signed-off-by: P J P <pjp@fedoraproject.org>
Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
---
 hw/net/ne2000.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

Index: qemu-2.3+dfsg/hw/net/ne2000.c
===================================================================
--- qemu-2.3+dfsg.orig/hw/net/ne2000.c	2015-09-23 15:04:54.411630430 -0400
+++ qemu-2.3+dfsg/hw/net/ne2000.c	2015-09-23 15:04:54.407630382 -0400
@@ -253,7 +253,7 @@
         if (index <= s->stop)
             avail = s->stop - index;
         else
-            avail = 0;
+            break;
         len = size;
         if (len > avail)
             len = avail;
