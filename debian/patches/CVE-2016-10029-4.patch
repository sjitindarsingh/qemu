From acfc4846508a02cc4c83aa27799fd74ac280bdb2 Mon Sep 17 00:00:00 2001
From: =?utf8?q?Marc-Andr=C3=A9=20Lureau?= <marcandre.lureau@redhat.com>
Date: Thu, 19 May 2016 12:25:59 +0200
Subject: [PATCH] virtio-gpu: use VIRTIO_GPU_MAX_SCANOUTS
MIME-Version: 1.0
Content-Type: text/plain; charset=utf8
Content-Transfer-Encoding: 8bit

The value is defined in virtio_gpu.h already (changing from 4 to 16).

Signed-off-by: Marc-AndrÃ© Lureau <marcandre.lureau@redhat.com>
Message-id: 1463653560-26958-6-git-send-email-marcandre.lureau@redhat.com
Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
---
 hw/display/virtio-gpu.c        | 4 ++--
 include/hw/virtio/virtio-gpu.h | 6 ++----
 2 files changed, 4 insertions(+), 6 deletions(-)

Index: qemu-2.5+dfsg/hw/display/virtio-gpu.c
===================================================================
--- qemu-2.5+dfsg.orig/hw/display/virtio-gpu.c	2017-04-04 15:56:03.213432654 -0400
+++ qemu-2.5+dfsg/hw/display/virtio-gpu.c	2017-04-04 15:56:03.209432603 -0400
@@ -893,8 +893,8 @@
     bool have_virgl;
     int i;
 
-    if (g->conf.max_outputs > VIRTIO_GPU_MAX_SCANOUT) {
-        error_setg(errp, "invalid max_outputs > %d", VIRTIO_GPU_MAX_SCANOUT);
+    if (g->conf.max_outputs > VIRTIO_GPU_MAX_SCANOUTS) {
+        error_setg(errp, "invalid max_outputs > %d", VIRTIO_GPU_MAX_SCANOUTS);
         return;
     }
 
Index: qemu-2.5+dfsg/include/hw/virtio/virtio-gpu.h
===================================================================
--- qemu-2.5+dfsg.orig/include/hw/virtio/virtio-gpu.h	2017-04-04 15:56:03.213432654 -0400
+++ qemu-2.5+dfsg/include/hw/virtio/virtio-gpu.h	2017-04-04 15:56:03.209432603 -0400
@@ -27,8 +27,6 @@
 
 #define VIRTIO_ID_GPU 16
 
-#define VIRTIO_GPU_MAX_SCANOUT 4
-
 struct virtio_gpu_simple_resource {
     uint32_t resource_id;
     uint32_t width;
@@ -96,8 +94,8 @@
     QTAILQ_HEAD(, virtio_gpu_simple_resource) reslist;
     QTAILQ_HEAD(, virtio_gpu_ctrl_command) fenceq;
 
-    struct virtio_gpu_scanout scanout[VIRTIO_GPU_MAX_SCANOUT];
-    struct virtio_gpu_requested_state req_state[VIRTIO_GPU_MAX_SCANOUT];
+    struct virtio_gpu_scanout scanout[VIRTIO_GPU_MAX_SCANOUTS];
+    struct virtio_gpu_requested_state req_state[VIRTIO_GPU_MAX_SCANOUTS];
 
     struct virtio_gpu_conf conf;
     int enabled_output_bitmask;
