From 1b85898025c4cd95dce673d15e67e60e98e91731 Mon Sep 17 00:00:00 2001
From: Prasad J Pandit <pjp@fedoraproject.org>
Date: Wed, 25 May 2016 16:01:29 +0530
Subject: [PATCH] scsi: megasas: use appropriate property buffer size

When setting MegaRAID SAS controller properties via MegaRAID
Firmware Interface(MFI) commands, a user supplied size parameter
is used to set property value. Use appropriate size value to avoid
OOB access issues.

Reported-by: Li Qiang <liqiang6-s@360.cn>
Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
Message-Id: <1464172291-2856-2-git-send-email-ppandit@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
---
 hw/scsi/megasas.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

Index: qemu-2.5+dfsg/hw/scsi/megasas.c
===================================================================
--- qemu-2.5+dfsg.orig/hw/scsi/megasas.c	2016-08-03 12:38:47.465744023 -0400
+++ qemu-2.5+dfsg/hw/scsi/megasas.c	2016-08-03 12:38:47.461743986 -0400
@@ -1445,7 +1445,7 @@
                                             dcmd_size);
         return MFI_STAT_INVALID_PARAMETER;
     }
-    dma_buf_write((uint8_t *)&info, cmd->iov_size, &cmd->qsg);
+    dma_buf_write((uint8_t *)&info, dcmd_size, &cmd->qsg);
     trace_megasas_dcmd_unsupported(cmd->index, cmd->iov_size);
     return MFI_STAT_OK;
 }
