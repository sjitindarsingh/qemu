Backport of:

From 4c1586787ff43c9acd18a56c12d720e3e6be9f7c Mon Sep 17 00:00:00 2001
From: Li Qiang <liqiang6-s@360.cn>
Date: Mon, 17 Oct 2016 14:13:58 +0200
Subject: [PATCH] 9pfs: fix memory leak in v9fs_link

The v9fs_link() function keeps a reference on the source fid object. This
causes a memory leak since the reference never goes down to 0. This patch
fixes the issue.

Signed-off-by: Li Qiang <liqiang6-s@360.cn>
Reviewed-by: Greg Kurz <groug@kaod.org>
[groug, rephrased the changelog]
Signed-off-by: Greg Kurz <groug@kaod.org>
---
 hw/9pfs/9p.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

Index: qemu-2.5+dfsg/hw/9pfs/virtio-9p.c
===================================================================
--- qemu-2.5+dfsg.orig/hw/9pfs/virtio-9p.c	2016-11-07 11:16:49.427065876 -0500
+++ qemu-2.5+dfsg/hw/9pfs/virtio-9p.c	2016-11-07 11:16:49.411065696 -0500
@@ -2364,6 +2364,7 @@
     if (!err) {
         err = offset;
     }
+    put_fid(pdu, oldfidp);
 out:
     put_fid(pdu, dfidp);
 out_nofid:
